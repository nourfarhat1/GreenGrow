<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qualité de l'air et irrigation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #ffffff;
            color: #333;
        }

        .air-quality-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 20px;
            margin-top: 20px;
        }

        .card-air-quality, .card-explanation {
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            text-align: center;
            flex: 1;
        }

        .progress-bar-air-quality {
            width: 100%;
            height: 20px;
            background: linear-gradient(to right, green, yellow, orange, red);
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
        }

        .progress-pointer {
            position: absolute;
            top: -5px;
            width: 10px;
            height: 30px;
            background: black;
            border-radius: 5px;
        }

        .card-explanation {
            max-width: 400px;
        }

        .card-explanation h3 {
            margin-bottom: 10px;
        }

        .card-explanation p {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="air-quality-container">
        <div class="card-air-quality">
            <h2 id="city">Chargement...</h2>
            <p id="status">Détail AQI : <span id="aqi">--</span> (<span id="description">--</span>)</p>
            <p id="health">PM₂₅ (particules fines) : -- µg/m³</p>
            <p><strong>Indice de qualité de l’air (IQA⁺) :</strong> <span id="iqaplus">--</span></p>
            <div class="progress-bar-air-quality">
                <div class="progress-pointer" id="pointer"></div>
            </div>
            <p id="advice">--</p>
        </div>

        <div class="card-explanation">
            <h3>Comprendre IQA⁺ et PM₂₅</h3>
            <p>L’IQA⁺ combine les données de pollution pour indiquer l’impact global sur l’environnement.</p>
            <p>Les particules PM₂₅ proviennent principalement des activités humaines et affectent la santé des plantes.</p>
            <p>En agriculture, une mauvaise qualité de l’air peut réduire la photosynthèse et augmenter les besoins en irrigation.</p>
        </div>        
    </div>

    <script>
        const apiKey = "d16324440d01f5e972aea9de07c50ab1";
        const lat = 36.8665;
        const lon = 10.1647;

        const aqiDescriptions = [
            "Bonne",
            "Acceptable",
            "Modérée",
            "Dégradée",
            "Mauvaise",
            "Très mauvaise"
        ];

        const agriculturalRisks = [
            "Conditions idéales pour l'agriculture.",
            "Peu d'impact, mais surveillez les besoins en eau.",
            "Légère réduction de la photosynthèse. Irriguer modérément.",
            "Stress pour les cultures. Augmentez l'irrigation.",
            "Risques élevés de dommages aux cultures. Prévoir une irrigation abondante.",
            "Conditions extrêmes : protégez vos cultures."
        ];

        async function fetchPollutionData() {
            try {
                const response = await fetch(`http://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${apiKey}`);
                const data = await response.json();
                displayData(data);
            } catch (error) {
                console.error("Erreur lors de la récupération des données :", error);
            }
        }

        function calculateIQAPlus(aqi, pm25) {
            return ((aqi * 0.7) + (pm25 / 10 * 0.3)).toFixed(1);
        }

        function displayData(data) {
            const aqi = data.list[0].main.aqi;
            const pm25 = data.list[0].components.pm2_5.toFixed(1);
            const iqaplus = calculateIQAPlus(aqi, pm25);

            document.getElementById("city").innerText = "Qualité de l'air à Ariana aujourd'hui";
            document.getElementById("aqi").innerText = aqi;
            document.getElementById("description").innerText = aqiDescriptions[aqi - 1];
            document.getElementById("health").innerText = `PM₂₅ : ${pm25} µg/m³`;
            document.getElementById("iqaplus").innerText = iqaplus;
            document.getElementById("advice").innerText = agriculturalRisks[aqi - 1];

            const pointer = document.getElementById("pointer");
            pointer.style.left = `${(aqi - 1) * 25}%`;
        }

        fetchPollutionData();
    </script>
</body>
</html>
